{extend name="public/base" /}
{block name="link"}
	<link rel="stylesheet" href="{$Think.config.parse_str.__CSS__}schedule-index.css">
	<script src="{$Think.config.parse_str.__JS__}/schedule-index.js"></script>
{/block}
	
{block name="main"}
		<div class="major">
			<div class="major-title">
				<h1>{$otheruser.name}课表</h1>
				<span></span>
				<p>Other schedule</p>
			</div>
			<div class="major-content clearfix">
				<div class="content-left">
					<p></p>
					<label>{$otheruser.name}</label>
					<ul>
						<li>有课</li>
						<li>无课</li>
					</ul>
				</div>
				<div class="content-right">
					<div class="clearfix">
						<div class="schedule-section">
							<form action="{:url('Schedule/other','','')}/{$otheruser.user_id}" method="get" id="test">
							<ul>
								<li class="arrow"><img src="{$Think.config.parse_str.__IMAGE__}up.png" id="lastWeek"></li>
								<div>
									
								</div>
								<li class="arrow"><img src="{$Think.config.parse_str.__IMAGE__}down.png" id="nextWeek"></li>
							</ul>
							</form>
						</div>
						<div class="schedule">
				  			<table class="table table-bordered">
								<tr>
									
									<th>星期一</th>
									<th>星期二</th>
									<th>星期三</th>
									<th>星期四</th>
									<th>星期五</th>
									<th>星期六</th>
									<th>星期日</th>
									
								</tr>
								{volist name="data" id="vo" key="i"}
									<tr>
										
										{volist name="vo" id="vo2"}
											<td class='course {if condition="$vo2.whether_course == 0"}white{/if}' data-toggle="modal" data-target="#myModal" data-id={$vo2.id}>
												<div>
													<span>{$vo2.name}</span>
													<br/>
													

													


													<span>{$vo2.classroom}</span>
												</div>
												{if condition="$vo2.whether_course == 2"}
													<img src="{$Think.config.parse_str.__IMAGE__}haveclass.png">
												{else/}
													<img src="{$Think.config.parse_str.__IMAGE__}noclass.png">
												{/if}				
											</td>
										{/volist}						
									</tr>
								{/volist}
				  			</table>
						</div>						
					</div>
					<div>
						<button type="button" class="btn btn-success" id="input">导入他的课表</button>
						<button type="button" data-toggle="modal" data-target="#myinfo" class="btn btn-danger" >他的信息</button>
						<!-- <button type="button" class="btn btn-danger">导出</button> -->
					</div>
				</div>
			</div>
		


























	<!-- <div class="text">
		<div class="text-week clearfix">
			<form action="{:url('Schedule/other','','')}/{$otheruser.user_id}" method="get" id="test">
				<span>当前周：</span>
				<select class="form-control" id="weeks" name="week">
					<option value='0'>本周</option>
					<option value='1'>第1周</option>
					<option value='2'>第2周</option>
					<option value='3'>第3周</option>
					<option value='4'>第4周</option>
					<option value='5'>第5周</option>
					<option value='6'>第6周</option>
					<option value='7'>第7周</option>
					<option value='8'>第8周</option>
					<option value='9'>第9周</option>
					<option value='10'>第10周</option>
					<option value='11'>第11周</option>
					<option value='12'>第12周</option>
					<option value='13'>第13周</option>
					<option value='14'>第14周</option>
					<option value='15'>第15周</option>
					<option value='16'>第16周</option>
					<option value='17'>第17周</option>
					<option value='18'>第18周</option>
					<option value='19'>第19周</option>
					<option value='20'>第20周</option>

				</select>				
			</form>
			<span style="margin-left: 10px;">{$otheruser.name}的课表</span>
			<div>
				<a href="" data-toggle="modal" data-target="#myinfo" class="btn btn-danger" style="background-color: #C23001;">他的信息</a>
				<button type="button" class="btn btn-success" id="input">导入他的课表</button>
			</div>
		</div>
		<div class="table-responsive curriculum">
  			<table class="table table-bordered schedule">
				<tr>
					<th>星期一</th>
					<th>星期二</th>
					<th>星期三</th>
					<th>星期四</th>
					<th>星期五</th>
					<th>星期六</th>
					<th>星期日</th>
				</tr>
				{volist name="data" id="vo"}
					<tr>
						{volist name="vo" id="vo2"}
							<td class='{if condition="$vo2.whether_course == 0"}color0{elseif condition="$vo2.whether_course eq 1"/}color1{/if} course' data-toggle="modal" data-target="#myModal" data-id={$vo2.id}>
								<div >
									<span>{$vo2.name}</span>
									<br/>
									<span>{$vo2.classroom}</span>
								</div>								
							</td>
						{/volist}						
					</tr>
				{/volist}
  			</table>
		</div> -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  			<div class="modal-dialog">
    			<div class="modal-content">
      				<div class="modal-header">
        				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        				<h4 class="modal-title" id="myModalLabel">查看课表</h4>
      				</div>
      				<div class="modal-body">
        				<form action="" class="form-horizontal" role="form">
        					<div class="form-group">
    							<label for="" class="col-sm-2 control-label">名称</label>
    							<div class="col-sm-10 test">
      								<input type="text" class="form-control" id="name" placeholder="未填写" disabled="disabled">
									<div class="list-group hint">
											
									</div>
    							</div>
  							</div>
  							<div class="form-group">
    							<label for="" class="col-sm-2 control-label">地点</label>
    							<div class="col-sm-10">
      								<input type="text" class="form-control" id="classroom" placeholder="未填写" disabled="disabled">
    							</div>
  							</div>
  							<div class="form-group">
    							<label for="" class="col-sm-2 control-label">老师</label>
    							<div class="col-sm-10">
      								<input type="text" class="form-control" id="teacher" placeholder="未填写" disabled="disabled">
    							</div>
  							</div>
  							<div class="form-group">
    							<label for="" class="col-sm-2 control-label">节数</label>
    							<div class="col-sm-10">
      								<select class="form-control" style="width:40%;float:left;margin-right: 50px;" id="week"  disabled="disabled">
									
									</select>
      								<select class="form-control" style="width:40%;float:left;" id="section"  disabled="disabled">
	
									</select>
    							</div>
  							</div>
  							<div class="form-group">
    							<label for="" class="col-sm-2 control-label">周数</label>
    							<div class="col-sm-10">
									<table class="table-bordered week">

									</table>
    							</div>		
							</div>

        				</form>
      				</div>
    			</div>
  			</div>
		</div>
	</div>

        <div class="modal fade" id="myinfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">个人信息</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" role="form">
                          <div class="form-group">
                            <label class="col-sm-2 control-label">学号：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.user_id}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">用户：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.name}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">组别：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.group_name}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">职务：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.position_name}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">性别：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{if condition="$otheruser.sex ==0"}男{else}女{/if}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">班级：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.class}</p>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label">电话：</label>
                            <div class="col-sm-10">
                              <p class="form-control-static">{$otheruser.phone}</p>
                            </div>
                          </div>
                        </form>                        
                    </div>
                </div>
            </div>
        </div>

	<script>
		$('.top>ul>li:eq(3)').addClass('nav_selected');
		var section = 0;
		var week = 0;
		var w = "{$week}";
		$('.schedule-section ul>div').html(getWeekSelect(parseInt(w)));


		// $('#weeks').find("option[value={$week}]").attr("selected",true);
		$('.main').on('click', '.course',function() {
			section = $(this).parent().index();
			week = $(this).index()+1;
			$.get(
				"{:url('Schedule/schedule')}",
				{
					otheruser:"{$otheruser.user_id}",
					week: week,
					section: section,
				},
				function(data){
					$('.hint').html('');
					$('#name').val(data.name);
					$('#classroom').val(data.classroom);
					$('#teacher').val(data.teacher);
					$('#week').html(getWeek(week));
					$('#section').html(getSection(section));
					$('.week').html(getWeeks(data.weeks_number));
				}
			);
		});
		/**
		 * 单选按钮的单击事件
		 * @param  {String} event) {			var      weeks [description]
		 * @return {[type]}        [description]
		 */
		$('input[type="radio"]').on('click', function(event) {
			var weeks = "";
			if($(this).val() == "option1"){
				weeks = "1,3,5,7,9,11,13,15,17,19";
			}else if($(this).val() == "option2"){
				weeks = "2,4,6,8,10,12,14,16,18,20";
			}else if($(this).val() == "option3"){
				weeks = "1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20";
			}else{
				weeks = "0";
			}
			$('.week').html(getWeeks(weeks));		
		});
		$('#weeks').on('change', function(event) {
			var id=$("#weeks").find("option:selected").val();
			if(id == 0){
				window.location.href = "{:url('Schedule/other','','')}/"+"{$otheruser.user_id}";
			}else{
				$('#test').submit();
			}
		});
		$('#input').on('click', function(event) {
			var account = "{$otheruser.user_id}";
			$.get(
	   			"{:url('Schedule/inputSch')}",
	   			{
	   				user_id: account,
	   			},
	   			function(data){
	   				if(data.code == 2){
	   					layer.msg(data.msg, {icon: 1}, function(){
	 							window.location.href = "{:url('Schedule/index')}";
	 						});
	   				}else{
	   					layer.msg(data.msg, {icon: 2});
	   				}
	   			}
			);
		});	


		$('#lastWeek').on('click', function(){
			var nowWeek = $('#nowWeek').data('id');
			$('.schedule-section ul>div').html( getWeekSelect(nowWeek-1));
			
				$('#test').submit();
			
		});
		$('#nextWeek').on('click', function(){
			var nowWeek = $('#nowWeek').data('id');
			$('.schedule-section ul>div').html( getWeekSelect(nowWeek+1));
			
				$('#test').submit();
			
		});
		function getWeekSelect(week){
			var weeks = ["本周", "第1周", "第2周", "第3周", "第4周", "第5周", "第6周", "第7周", "第8周", "第9周", "第10周", "第11周", "第12周", "第13周", "第14周", "第15周", "第16周", "第17周", "第18周", "第19周", "第20周"];
			var lastid = 0,nowid =0 ,nextid = 0;
			if(week < 0){
				lastid =weeks.length-2;
				nowid = weeks.length-1;
				nextid = 0;
			}else if(week == 0){
				lastid = weeks.length-1;
				nowid = 0;
				nextid = 1;
			}else if(week > weeks.length-1){
				lastid =weeks.length-1;
				nowid = 0;
				nextid = 1;
			}else if(week == weeks.length-1){
				lastid =week-1;
				nowid = weeks.length-1;
				nextid = 0;
			}else{
				lastid =week-1;
				nowid = week;
				nextid = week+1;
			}
			var html ='<li class=""><span>'+weeks[lastid]+'</span></li><li><label id="nowWeek" data-id="'+nowid+'">'+'<input type="hidden" name="week" value="'+nowid+'">'+weeks[nowid]+'</label></li><li class=""><span>'+weeks[nextid]+'</span></li>';
			return html;
		}
	</script>
{/block}